{"ast":null,"code":"import _slicedToArray from\"D:/collection/PROJECT`s/JAPAN/8863074498439810063enhancementv7/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"D:/collection/PROJECT`s/JAPAN/8863074498439810063enhancementv7/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/collection/PROJECT`s/JAPAN/8863074498439810063enhancementv7/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import*as BABYLON from\"babylonjs\";import\"babylonjs-inspector\";import\"babylonjs-loaders\";import LoaderManager from\"./LoaderManager\";import{Categories}from\"../../Config.json\";var StudioSceneManager=/*#__PURE__*/function(){function StudioSceneManager(game){var _this=this;_classCallCheck(this,StudioSceneManager);this.game=game;//Main Props\nthis.scene=null;this.studioGui=null;this.mainCamera=null;this.pipline=null;//\nthis.charcterProps={};//initObj\nObject.keys(Categories).forEach(function(key){_this.charcterProps[key]=null;});this.hdrTexturePath=\"https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/DDS/Runyon_Canyon_A_2k_cube_specular.dds\";this.skyboxPath=\"https://assets.babylonjs.com/environments/environmentSpecular.env\";}//#region  MainSceneProperties\n_createClass(StudioSceneManager,[{key:\"CreateScene\",value:function CreateScene(){var _this2=this;//Create Bts Scene\n//Create Scene\nthis.scene=new BABYLON.Scene(this.game.engine);this.scene.clearColor=new BABYLON.Color4(0,0,0,0.0000000000000001);this.scene.imageProcessingConfiguration.colorCurvesEnabled=true;this.scene.imageProcessingConfiguration.colorCurves=new BABYLON.ColorCurves();this.scene.imageProcessingConfiguration.colorCurves.globalSaturation=0;this.scene.imageProcessingConfiguration.contrast=2.5;this.scene.imageProcessingConfiguration.vignetteEnabled=true;this.scene.onPointerObservable.add(function(pointerInfo){switch(pointerInfo.type){case BABYLON.PointerEventTypes.POINTERDOWN:_this2.onPointerDown(pointerInfo.event);break;case BABYLON.PointerEventTypes.POINTERUP:_this2.onPointerUp(pointerInfo.event);break;case BABYLON.PointerEventTypes.POINTERMOVE:_this2.onPointerMove(pointerInfo.event);break;case BABYLON.PointerEventTypes.POINTERDOUBLETAP:break;case BABYLON.PointerEventTypes.POINTERWHEEL:_this2.MouseWheelHandler();break;default:break;}});//Installation\nthis.createCamera();this.setUpEnvironMent();//Create LoadManager instance\nthis.loaderManager=new LoaderManager(this);this.loaderManager.loadItemById(\"base\",\"base\");//start load base Charcter\n// this.scene.debugLayer.show();\nreturn this.scene;}},{key:\"createCamera\",value:function createCamera(){this.mainCamera=new BABYLON.ArcRotateCamera(\"ArcCamera\",4.69,1.42,55,new BABYLON.Vector3(0,0,0),this.scene);this.mainCamera.attachControl(this.game.canvas,true);this.mainCamera.lowerRadiusLimit=20;this.mainCamera.upperRadiusLimit=85;this.mainCamera.lowerBetaLimit=0.85;this.mainCamera.upperBetaLimit=1.5;this.mainCamera.minZ=0.2;this.mainCamera.target=new BABYLON.Vector3(3,4,0.7);this.mainCamera.wheelPrecision=10;this.mainCamera.useBouncingBehavior=true;}},{key:\"setUpEnvironMent\",value:function setUpEnvironMent(){var hemiLight=new BABYLON.HemisphericLight(\"HemiLight\",new BABYLON.Vector3(0,-1,-0),this.scene);hemiLight.intensity=1;var dirLight=new BABYLON.DirectionalLight(\"DirectionalLight\",new BABYLON.Vector3(0,-1,0),this.scene);dirLight.position=new BABYLON.Vector3(3,9,3);this.alphaMaterial=new BABYLON.StandardMaterial(\"alphaMat\",this.scene);this.alphaMaterial.alpha=0;// ShadowGenerator\nthis.shadowGenerator=new BABYLON.ShadowGenerator(512,dirLight);this.shadowGenerator.useBlurExponentialShadowMap=true;this.shadowGenerator.filteringQuality=BABYLON.ShadowGenerator.QUALITY_HIGH;dirLight.intensity=1;dirLight.shadowMinZ=0;dirLight.shadowMaxZ=500;var skybox=BABYLON.CubeTexture.CreateFromPrefilteredData(this.skyboxPath,this.scene);skybox.gammaSpace=true;var skyboxMaterial=new BABYLON.StandardMaterial(\"sky7Box\",this.scene);skyboxMaterial.backFaceCulling=false;skyboxMaterial.reflectionTexture=new BABYLON.CubeTexture(this.skyboxPath,this.scene);skyboxMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE;skybox.infiniteDistance=true;skybox.material=skyboxMaterial;// Our built-in 'ground' shape. Params: name, width, depth, subdivs, scene\nvar ground=BABYLON.Mesh.CreateGround(\"ground1\",35,35,150,this.scene);ground.position.y-=4;ground.receiveShadows=true;// Create and tweak the background material.\nvar backgroundMaterial=new BABYLON.BackgroundMaterial(\"backgroundMaterial\",this.scene);backgroundMaterial.diffuseTexture=new BABYLON.Texture(\"./Textuers/scene/backgroundGround.png\",this.scene);backgroundMaterial.diffuseTexture.hasAlpha=true;backgroundMaterial.opacityFresnel=false;backgroundMaterial.shadowLevel=0.85;backgroundMaterial.alpha=0.4;//Create CubicTexture\n// let skyboxCubecTexture = BABYLON.CubeTexture.CreateFromPrefilteredData(\n//     // this.skyboxPath,\n//         \"./environment/empty_warehouse2.env\",\n//         this.scene\n//         );\n//     skyboxCubecTexture.gammaSpace = true;\n//     skyboxCubecTexture.level = .8;\n// this.scene.environmentTexture=skyboxCubecTexture;\n//Mirror\nthis.mirror=new BABYLON.MirrorTexture(\"mirror\",512,this.scene);// this.mirror.mirrorPlane = new BABYLON.Plane(0, -1, -.5, 0);\nthis.mirror.mirrorPlane=new BABYLON.Plane(0,-0.8,-0,-1);this.mirror.adaptiveBlurKernel=32;// this.Groundmirror.mirrorPlane = new BABYLON.Plane(0, -.69, -0, -1);\nbackgroundMaterial.reflectionTexture=this.mirror;backgroundMaterial.reflectionFresnel=true;backgroundMaterial.reflectionStandardFresnelWeight=0.9;backgroundMaterial.reflectionTexture.level=0.8;ground.material=backgroundMaterial;// var box2 = BABYLON.MeshBuilder.CreateBox(\n//   \"box\",\n//   {\n//     width: BoxWidth,\n//     depth: BoxLength,\n//     height: 10,\n//   },\n//   this.scene\n// );\n// let mat = new BABYLON.PBRMaterial(\"DD\",this.scene);\n// box2.material = mat;\n// mat.albedoColor = new BABYLON.Color3(103/255,103/255,103/255)\n// box2.position = new BABYLON.Vector3(0, 5, 1);\n// box2.visibility = 0.2;\n// this.scene.registerBeforeRender(() => {\n// });\n// //Create RenderPipline\n// this.RenderPipline = new BABYLON.DefaultRenderingPipeline(\"default\", // The name of the pipeline\n// true, // Do you want HDR textures ?\n// this.scene, // The scene instance\n// [this.mainCamera] // The list of cameras to be attached to\n// );\n// this.RenderPipline.samples = s4;\n// this.RenderPipline.bloomEnabled=true;\n// // this.RenderPipline.glowLayer.intensity=3.5;\n// // this.RenderPipline.glowLayer.blurKernelSize=180;\n// this.RenderPipline.MineglowLayer =new BABYLON.GlowLayer(\"glowww\", this.scene, {\n//     mainTextureFixedSize: 512,\n//     blurKernelSize: 190\n//     }\n// );\n// this.RenderPipline.MineglowLayer.intensity = 2.70;\n//#region fff\n// var alpha = 0;\n// this.scene.registerBeforeRender(() => {\n// });\n//#endregion\n// var skyBack = new BABYLON.Layer(\"skyBack\", \"./Textuers/scene/skyBack_edit.png\", this.scene,true, new BABYLON.Color4(1,1,1,1));\n}//#endregion\n//region SceneActions\n},{key:\"handleLoadItemPerId\",value:function handleLoadItemPerId(type,name,onLoad){var isExsits=this.charcterProps[type];if(isExsits){this.charcterProps[type].dispose();this.charcterProps[type]=null;}if(!name){onLoad({data:this.getCharcterSummary(),totalPrice:this.getTotatlPrice()});return;}this.loaderManager.loadItemById(type,name,onLoad);}},{key:\"getCharcterSummary\",value:function getCharcterSummary(){return Object.entries(this.charcterProps).filter(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return key!==\"base\";}).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),key=_ref4[0],value=_ref4[1];if(value){return{category:key,item:value.itemName,price:value.price};}else{return{category:key,item:\"No Item Selected\",price:0};}});}},{key:\"getTotatlPrice\",value:function getTotatlPrice(){return Object.values(this.charcterProps).reduce(function(sum,ele){if(ele&&ele.myId!==\"base\")return sum+ele.price;else return sum;},0);}},{key:\"handleChangeCatColor\",value:function handleChangeCatColor(catType,hexColor){var isExsits=this.charcterProps[catType];if(isExsits){if(!this.charcterProps[catType].getChildMeshes(true)[0].defualtColor){this.charcterProps[catType].getChildMeshes(true)[0].defualtColor=this.charcterProps[catType].getChildMeshes(true)[0].material.albedoColor.toHexString();}if(hexColor)this.charcterProps[catType].getChildMeshes(true)[0].material.albedoColor=new BABYLON.Color3.FromHexString(hexColor);else{this.charcterProps[catType].getChildMeshes(true)[0].material.albedoColor=new BABYLON.Color3.FromHexString(this.charcterProps[catType].getChildMeshes(true)[0].defualtColor);}}}},{key:\"loadAllCharcterData\",value:function loadAllCharcterData(items,onFinish){var _this3=this;var index=0;var onItemLoad=function onItemLoad(result){index++;if(index===loadedItems.length)onFinish(result);};var loadedItems=items.filter(function(catObj){return catObj.item;});loadedItems.forEach(function(catObj){_this3.loaderManager.loadItemById(catObj.category,catObj.item,onItemLoad);});}},{key:\"clearCharcterData\",value:function clearCharcterData(){var _this4=this;Object.keys(Categories).forEach(function(key){if(_this4.charcterProps[key])_this4.charcterProps[key].dispose();_this4.charcterProps[key]=null;});}//#endregion\n//#region UserInput (Mouse)\n},{key:\"onPointerDown\",value:function onPointerDown(ev){}},{key:\"onPointerUp\",value:function onPointerUp(ev){}},{key:\"onPointerMove\",value:function onPointerMove(ev){}},{key:\"MouseWheelHandler\",value:function MouseWheelHandler(ev){}//#endregion\n}]);return StudioSceneManager;}();export{StudioSceneManager as default};","map":{"version":3,"sources":["D:/collection/PROJECT`s/JAPAN/8863074498439810063enhancementv7/src/Babylon/StudioScene/StudioSceneManager.js"],"names":["BABYLON","LoaderManager","Categories","StudioSceneManager","game","scene","studioGui","mainCamera","pipline","charcterProps","Object","keys","forEach","key","hdrTexturePath","skyboxPath","Scene","engine","clearColor","Color4","imageProcessingConfiguration","colorCurvesEnabled","colorCurves","ColorCurves","globalSaturation","contrast","vignetteEnabled","onPointerObservable","add","pointerInfo","type","PointerEventTypes","POINTERDOWN","onPointerDown","event","POINTERUP","onPointerUp","POINTERMOVE","onPointerMove","POINTERDOUBLETAP","POINTERWHEEL","MouseWheelHandler","createCamera","setUpEnvironMent","loaderManager","loadItemById","ArcRotateCamera","Vector3","attachControl","canvas","lowerRadiusLimit","upperRadiusLimit","lowerBetaLimit","upperBetaLimit","minZ","target","wheelPrecision","useBouncingBehavior","hemiLight","HemisphericLight","intensity","dirLight","DirectionalLight","position","alphaMaterial","StandardMaterial","alpha","shadowGenerator","ShadowGenerator","useBlurExponentialShadowMap","filteringQuality","QUALITY_HIGH","shadowMinZ","shadowMaxZ","skybox","CubeTexture","CreateFromPrefilteredData","gammaSpace","skyboxMaterial","backFaceCulling","reflectionTexture","coordinatesMode","Texture","SKYBOX_MODE","infiniteDistance","material","ground","Mesh","CreateGround","y","receiveShadows","backgroundMaterial","BackgroundMaterial","diffuseTexture","hasAlpha","opacityFresnel","shadowLevel","mirror","MirrorTexture","mirrorPlane","Plane","adaptiveBlurKernel","reflectionFresnel","reflectionStandardFresnelWeight","level","name","onLoad","isExsits","dispose","data","getCharcterSummary","totalPrice","getTotatlPrice","entries","filter","value","map","category","item","itemName","price","values","reduce","sum","ele","myId","catType","hexColor","getChildMeshes","defualtColor","albedoColor","toHexString","Color3","FromHexString","items","onFinish","index","onItemLoad","result","loadedItems","length","catObj","ev"],"mappings":"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","sourcesContent":["import * as BABYLON from \"babylonjs\";\r\nimport \"babylonjs-inspector\";\r\nimport \"babylonjs-loaders\";\r\nimport LoaderManager from \"./LoaderManager\";\r\nimport { Categories } from \"../../Config.json\";\r\n\r\nexport default class StudioSceneManager {\r\n  constructor(game) {\r\n    this.game = game;\r\n    //Main Props\r\n    this.scene = null;\r\n    this.studioGui = null;\r\n    this.mainCamera = null;\r\n    this.pipline = null;\r\n\r\n    //\r\n    this.charcterProps = {};\r\n    //initObj\r\n    Object.keys(Categories).forEach((key) => {\r\n      this.charcterProps[key] = null;\r\n    });\r\n\r\n    this.hdrTexturePath =\r\n      \"https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/DDS/Runyon_Canyon_A_2k_cube_specular.dds\";\r\n    this.skyboxPath =\r\n      \"https://assets.babylonjs.com/environments/environmentSpecular.env\";\r\n  }\r\n\r\n  //#region  MainSceneProperties\r\n  CreateScene() {\r\n    //Create Bts Scene\r\n    //Create Scene\r\n    this.scene = new BABYLON.Scene(this.game.engine);\r\n    this.scene.clearColor = new BABYLON.Color4(0, 0, 0, 0.0000000000000001);\r\n    this.scene.imageProcessingConfiguration.colorCurvesEnabled = true;\r\n    this.scene.imageProcessingConfiguration.colorCurves = new BABYLON.ColorCurves();\r\n    this.scene.imageProcessingConfiguration.colorCurves.globalSaturation = 0;\r\n    this.scene.imageProcessingConfiguration.contrast = 2.5;\r\n    this.scene.imageProcessingConfiguration.vignetteEnabled = true;\r\n\r\n    this.scene.onPointerObservable.add((pointerInfo) => {\r\n      switch (pointerInfo.type) {\r\n        case BABYLON.PointerEventTypes.POINTERDOWN:\r\n          this.onPointerDown(pointerInfo.event);\r\n          break;\r\n        case BABYLON.PointerEventTypes.POINTERUP:\r\n          this.onPointerUp(pointerInfo.event);\r\n          break;\r\n        case BABYLON.PointerEventTypes.POINTERMOVE:\r\n          this.onPointerMove(pointerInfo.event);\r\n          break;\r\n        case BABYLON.PointerEventTypes.POINTERDOUBLETAP:\r\n          break;\r\n        case BABYLON.PointerEventTypes.POINTERWHEEL:\r\n          this.MouseWheelHandler();\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n\r\n    //Installation\r\n    this.createCamera();\r\n    this.setUpEnvironMent();\r\n\r\n    //Create LoadManager instance\r\n    this.loaderManager = new LoaderManager(this);\r\n    this.loaderManager.loadItemById(\"base\", \"base\"); //start load base Charcter\r\n\r\n    // this.scene.debugLayer.show();\r\n\r\n    return this.scene;\r\n  }\r\n  createCamera() {\r\n    this.mainCamera = new BABYLON.ArcRotateCamera(\r\n      \"ArcCamera\",\r\n      4.69,\r\n      1.42,\r\n      55,\r\n      new BABYLON.Vector3(0, 0, 0),\r\n      this.scene\r\n    );\r\n    this.mainCamera.attachControl(this.game.canvas, true);\r\n\r\n    this.mainCamera.lowerRadiusLimit = 20;\r\n    this.mainCamera.upperRadiusLimit = 85;\r\n\r\n    this.mainCamera.lowerBetaLimit = 0.85;\r\n    this.mainCamera.upperBetaLimit = 1.5;\r\n\r\n    this.mainCamera.minZ = 0.2;\r\n    this.mainCamera.target = new BABYLON.Vector3(3, 4, 0.7);\r\n\r\n    this.mainCamera.wheelPrecision = 10;\r\n    this.mainCamera.useBouncingBehavior = true;\r\n  }\r\n  setUpEnvironMent() {\r\n    let hemiLight = new BABYLON.HemisphericLight(\r\n      \"HemiLight\",\r\n      new BABYLON.Vector3(0, -1, -0),\r\n      this.scene\r\n    );\r\n    hemiLight.intensity = 1;\r\n\r\n    let dirLight = new BABYLON.DirectionalLight(\r\n      \"DirectionalLight\",\r\n      new BABYLON.Vector3(0, -1, 0),\r\n      this.scene\r\n    );\r\n    dirLight.position = new BABYLON.Vector3(3, 9, 3);\r\n\r\n    this.alphaMaterial = new BABYLON.StandardMaterial(\"alphaMat\", this.scene);\r\n    this.alphaMaterial.alpha = 0;\r\n\r\n    // ShadowGenerator\r\n    this.shadowGenerator = new BABYLON.ShadowGenerator(512, dirLight);\r\n    this.shadowGenerator.useBlurExponentialShadowMap = true;\r\n    this.shadowGenerator.filteringQuality =\r\n      BABYLON.ShadowGenerator.QUALITY_HIGH;\r\n    dirLight.intensity = 1;\r\n    dirLight.shadowMinZ = 0;\r\n    dirLight.shadowMaxZ = 500;\r\n\r\n    let skybox = BABYLON.CubeTexture.CreateFromPrefilteredData(\r\n      this.skyboxPath,\r\n      this.scene\r\n    );\r\n    skybox.gammaSpace = true;\r\n\r\n    let skyboxMaterial = new BABYLON.StandardMaterial(\"sky7Box\", this.scene);\r\n    skyboxMaterial.backFaceCulling = false;\r\n    skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture(\r\n      this.skyboxPath,\r\n      this.scene\r\n    );\r\n    skyboxMaterial.reflectionTexture.coordinatesMode =\r\n      BABYLON.Texture.SKYBOX_MODE;\r\n    skybox.infiniteDistance = true;\r\n    skybox.material = skyboxMaterial;\r\n\r\n    // Our built-in 'ground' shape. Params: name, width, depth, subdivs, scene\r\n    let ground = BABYLON.Mesh.CreateGround(\"ground1\", 35, 35, 150, this.scene);\r\n    ground.position.y -= 4;\r\n    ground.receiveShadows = true;\r\n\r\n    // Create and tweak the background material.\r\n    var backgroundMaterial = new BABYLON.BackgroundMaterial(\r\n      \"backgroundMaterial\",\r\n      this.scene\r\n    );\r\n    backgroundMaterial.diffuseTexture = new BABYLON.Texture(\r\n      \"./Textuers/scene/backgroundGround.png\",\r\n      this.scene\r\n    );\r\n    backgroundMaterial.diffuseTexture.hasAlpha = true;\r\n    backgroundMaterial.opacityFresnel = false;\r\n    backgroundMaterial.shadowLevel = 0.85;\r\n    backgroundMaterial.alpha = 0.4;\r\n\r\n    //Create CubicTexture\r\n    // let skyboxCubecTexture = BABYLON.CubeTexture.CreateFromPrefilteredData(\r\n    //     // this.skyboxPath,\r\n    //         \"./environment/empty_warehouse2.env\",\r\n    //         this.scene\r\n    //         );\r\n    //     skyboxCubecTexture.gammaSpace = true;\r\n    //     skyboxCubecTexture.level = .8;\r\n    // this.scene.environmentTexture=skyboxCubecTexture;\r\n\r\n    //Mirror\r\n    this.mirror = new BABYLON.MirrorTexture(\"mirror\", 512, this.scene);\r\n    // this.mirror.mirrorPlane = new BABYLON.Plane(0, -1, -.5, 0);\r\n    this.mirror.mirrorPlane = new BABYLON.Plane(0, -0.8, -0, -1);\r\n\r\n    this.mirror.adaptiveBlurKernel = 32;\r\n    // this.Groundmirror.mirrorPlane = new BABYLON.Plane(0, -.69, -0, -1);\r\n    backgroundMaterial.reflectionTexture = this.mirror;\r\n    backgroundMaterial.reflectionFresnel = true;\r\n    backgroundMaterial.reflectionStandardFresnelWeight = 0.9;\r\n    backgroundMaterial.reflectionTexture.level = 0.8;\r\n    ground.material = backgroundMaterial;\r\n\r\n    // var box2 = BABYLON.MeshBuilder.CreateBox(\r\n    //   \"box\",\r\n    //   {\r\n    //     width: BoxWidth,\r\n    //     depth: BoxLength,\r\n    //     height: 10,\r\n    //   },\r\n    //   this.scene\r\n    // );\r\n    // let mat = new BABYLON.PBRMaterial(\"DD\",this.scene);\r\n    // box2.material = mat;\r\n    // mat.albedoColor = new BABYLON.Color3(103/255,103/255,103/255)\r\n    // box2.position = new BABYLON.Vector3(0, 5, 1);\r\n    // box2.visibility = 0.2;\r\n\r\n    // this.scene.registerBeforeRender(() => {\r\n    // });\r\n\r\n    // //Create RenderPipline\r\n    // this.RenderPipline = new BABYLON.DefaultRenderingPipeline(\"default\", // The name of the pipeline\r\n    // true, // Do you want HDR textures ?\r\n    // this.scene, // The scene instance\r\n    // [this.mainCamera] // The list of cameras to be attached to\r\n    // );\r\n\r\n    // this.RenderPipline.samples = s4;\r\n    // this.RenderPipline.bloomEnabled=true;\r\n    // // this.RenderPipline.glowLayer.intensity=3.5;\r\n    // // this.RenderPipline.glowLayer.blurKernelSize=180;\r\n\r\n    // this.RenderPipline.MineglowLayer =new BABYLON.GlowLayer(\"glowww\", this.scene, {\r\n    //     mainTextureFixedSize: 512,\r\n    //     blurKernelSize: 190\r\n    //     }\r\n    // );\r\n    // this.RenderPipline.MineglowLayer.intensity = 2.70;\r\n\r\n    //#region fff\r\n    // var alpha = 0;\r\n    // this.scene.registerBeforeRender(() => {\r\n    // });\r\n    //#endregion\r\n\r\n    // var skyBack = new BABYLON.Layer(\"skyBack\", \"./Textuers/scene/skyBack_edit.png\", this.scene,true, new BABYLON.Color4(1,1,1,1));\r\n  }\r\n  //#endregion\r\n\r\n  //region SceneActions\r\n  handleLoadItemPerId(type, name, onLoad) {\r\n    const isExsits = this.charcterProps[type];\r\n    if (isExsits) {\r\n      this.charcterProps[type].dispose();\r\n      this.charcterProps[type] = null;\r\n    }\r\n    if (!name) {\r\n      onLoad({\r\n        data: this.getCharcterSummary(),\r\n        totalPrice: this.getTotatlPrice(),\r\n      });\r\n      return;\r\n    }\r\n    this.loaderManager.loadItemById(type, name, onLoad);\r\n  }\r\n  getCharcterSummary() {\r\n    return Object.entries(this.charcterProps)\r\n      .filter(([key, value]) => {\r\n        return key !== \"base\";\r\n      })\r\n      .map(([key, value]) => {\r\n        if (value) {\r\n          return { category: key, item: value.itemName, price: value.price };\r\n        } else {\r\n          return { category: key, item: \"No Item Selected\", price: 0 };\r\n        }\r\n      });\r\n  }\r\n  getTotatlPrice() {\r\n    return Object.values(this.charcterProps).reduce((sum, ele) => {\r\n      if (ele && ele.myId !== \"base\") return sum + ele.price;\r\n      else return sum;\r\n    }, 0);\r\n  }\r\n  handleChangeCatColor(catType, hexColor) {\r\n    const isExsits = this.charcterProps[catType];\r\n    if (isExsits) {\r\n      if (!this.charcterProps[catType].getChildMeshes(true)[0].defualtColor) {\r\n        this.charcterProps[catType].getChildMeshes(\r\n          true\r\n        )[0].defualtColor = this.charcterProps[catType]\r\n          .getChildMeshes(true)[0]\r\n          .material.albedoColor.toHexString();\r\n      }\r\n      if (hexColor)\r\n        this.charcterProps[catType].getChildMeshes(\r\n          true\r\n        )[0].material.albedoColor = new BABYLON.Color3.FromHexString(hexColor);\r\n      else {\r\n        this.charcterProps[catType].getChildMeshes(\r\n          true\r\n        )[0].material.albedoColor = new BABYLON.Color3.FromHexString(\r\n          this.charcterProps[catType].getChildMeshes(true)[0].defualtColor\r\n        );\r\n      }\r\n    }\r\n  }\r\n  loadAllCharcterData(items, onFinish) {\r\n    let index = 0;\r\n    const onItemLoad = (result) => {\r\n      index++;\r\n      if (index === loadedItems.length) onFinish(result);\r\n    };\r\n\r\n    let loadedItems = items.filter((catObj) => catObj.item);\r\n    loadedItems.forEach((catObj) => {\r\n      this.loaderManager.loadItemById(catObj.category, catObj.item, onItemLoad);\r\n    });\r\n\r\n  }\r\n  clearCharcterData(){\r\n    Object.keys(Categories).forEach((key) => {\r\n      if(this.charcterProps[key]) this.charcterProps[key].dispose();\r\n      this.charcterProps[key] = null;\r\n    });\r\n  }\r\n\r\n  //#endregion\r\n\r\n  //#region UserInput (Mouse)\r\n  onPointerDown(ev) {}\r\n  onPointerUp(ev) {}\r\n  onPointerMove(ev) {}\r\n  MouseWheelHandler(ev) {}\r\n  //#endregion\r\n}\r\n"]},"metadata":{},"sourceType":"module"}